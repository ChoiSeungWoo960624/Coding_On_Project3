# Railway Simulation Project 🚈

- [x]  전철 시뮬레이션

## 📝 프로젝트 소개

* **주제**  
  PLC와 HMI를 이용하여 전철의 운행을 시뮬레이션하는 시스템을 구축
  

* **기획 의도**  
  전철의 출발, 정차, 속도 제어 및 신호 시스템을 포함, HMI를 통해 실시간으로 운행 상태를 모니터링하고 조작하여,  기관사 훈련의 효율성을 높이고, 운행 절차의 표준화를 도모하며, 비상 상황에서의 신속한 대응 능력을 배양하는 데 중점을 둠. 또한, 자동화된 데이터 분석을 활용하여 운행 중 발생하는 변수들을 정밀하게 측정하고, 이를 통해 보다 정교한 시뮬레이션 환경을 구축하는 것을 목표로 설정함.

  이 시스템을 통해 개인은 운행 절차를 체계적으로 익히고, 실전 경험을 쌓으며 안전한 운행 능력을 향상시킬 수 있음. 이를 통해 기관사 및 운전 연습생의 숙련도가 증가하고, 실전에서의 운행 실수를 최소화할 수 있음.

  반면, 단체(철도 운영 기관과 철도 관련 교육 기관)은 보다 체계적인 훈련 프로그램을 운영할 수 있으며, 안전사고 예방을 통한 비용 절감과 운행 효율성 향상 효과를 기대할 수 있음. 또한, 표준화된 운행 프로세스를 정착시킴으로써 기관사 간의 기술 격차를 줄이고, 전체적인 운행 안전성을 높이는 데 기여할 수 있도록 계획했으며 기대효과라고 생각함.
  

* **기간**  
  2025.03.14. ~ 2025.03.30. (16일)

## 🛤️ 프로젝트 시행 영상
![11-ezgif com-video-to-gif-converter](https://github.com/user-attachments/assets/4b8a940b-fc24-42fb-9f85-80bbcc8da092)

## 🚆 전철 시뮬레이션 동작 원리 및 시나리오

### 1. 시동 시스템

#### 1.1 시동 OFF 상태
- 전철 내 모든 기능 정지
- 전철 운행 및 출입문 제어 불가능

#### 1.2 시동 ON 조건 및 동작
1. **시동_열쇠_구멍 스위치 ON** → %MX0 (열쇠 ON) 신호 활성화
2. 시동이 켜지면 **출입문 기능** (열고, 닫기, 점등)만 사용 가능
3. **POWER_ON** 활성화 시 HMI의 축전지 전압계 상승
4. **POWER_ON**, **EB 버튼**, **ATS_P 버튼**을 각각 누르면 해당 램프 점등
5. **POWER_ON**, **EB 버튼**, **ATS_P 버튼** 모두 눌려야 열차 운행 준비 완료
6. 운행 준비 완료되지 않으면 **출발 버튼**과 **정지 버튼** 작동 불가
7. 운행 중 **EB(비상 정지 버튼)** 활성화 시 전진/브레이크 기능 비활성화, 열차 멈춤
8. 운행 중 **시동 열쇠 스위치 OFF** 시 모든 기능 정지

### 2. 출입문 시스템

#### 2.1 출입문 동작
1. **출입문 스위치 활성화** → 출입문 램프 활성화  
   - 네모 램프: 문 닫는 타이밍 표시  
   - 동그라미 램프: 문 열림 표시

2. 출입문 스위치 활성화 후 **10초 경과**
   - 동그라미 램프 깜박임 (문 열리고 있음을 알림)
   - 네모 램프 붉은 빛 유지

3. 출입문 스위치 활성화 후 **15초 경과**
   - 동그라미 램프 점등 유지, 네모 램프 붉은 빛 유지

4. 출입문 스위치 활성화 후 **20초 경과**
   - 네모 램프 초록색으로 변하며 깜박임 (문 닫을 타이밍 알림)
   - 동그라미 램프 점등 유지

5. **출입문 닫힘 조건**
   - 출입문 닫히면 동그라미 램프 OFF
   - 네모 램프 초록색으로 점등

### 3. 열차 운행 시스템

운행 시작 전 **시동 ON**, **POWER_ON**, **EB 버튼**, **ATS_P 버튼** 모두 활성화되어야 함.

#### 3.1 출발 (전진) 버튼
1. **출발 버튼 활성화**
   - 압력계 및 전동기 전류계 상승
   - 속력 0.1초마다 1씩 증가, 최대 속력은 100 (이상 상승 불가)
   - 속력에 따라 남은 거리 감소

2. **출발 버튼 다시 누르면**
   - **정지 버튼** 활성화, **출발 버튼 OFF**

#### 3.2 정지 (브레이크) 버튼
1. **브레이크 활성화 시**
   - 속도 1초마다 1씩 감소
   - 출발 버튼 OFF
   - 남은 속력만큼 남은 거리 감소

### 4. EB (Emergency Train Stop Button, 비상 정지 버튼)

#### 4.1 EB 버튼 동작
1. **출발 또는 브레이크 동작 중 EB 버튼 누르면**
   - 열차 즉시 정지, 속도 0km/h로 변경
   - EB 버튼 위 빨간 램프 점등

2. **다시 운행하려면**
   - EB 버튼을 한 번 더 눌러 해제해야 함

### 5. 남은 거리 표시기

#### 5.1 출발 버튼을 누르면
- 속도에 따라 남은 거리가 자동으로 감소

#### 5.2 정지(브레이크) 버튼을 누르면
- 감속되는 속력에 따라 남은 거리가 자동 감소

#### 5.3 남은 거리가 200m 이하일 때
- "정차역 램프"가 깜박이며 곧 다음 역 도착을 알림

### 6. 운행 종료 절차

1. 출입문 개방 후 승객이 모두 내릴 때까지 대기
2. **ATS_P 버튼 OFF** 후, **ATS_P 램프** 소등 확인
3. **POWER OFF** 후, 축전지 전압계 하강 확인
4. **Key 제거** 후 "Key 입력" 램프 소등 확인 후 운행 종료

### 7. 날짜 및 시간 표시

- 시뮬레이션 동작 시, **현재 날짜와 시간** 자동 설정 및 표시

## 🛠️사용한 기술

|카테고리|기술|
|:-|:-|
| **PLC** | - 전철의 속도, 정차, 출발 등 신호 체계 제어 <br> - 거리 계산을 이용한 역 도착 여부 및 안전 시스템 구현 <br> - 긴급 정지 버튼과 HMI 연동 <br> - 출입문 제어 |
| **HMI** | - 전철 위치, 속도, 시간 등의 실시간 모니터링 <br> - 출발, 정차, 속도 조절 등의 명령 입력 <br> - 비상 정지 버튼 구현 |


## 💡주요기술 채택 이유

- **PLC (Programmable Logic Controller)**
  - 실시간 제어가 가능하여 전철 운행과 같은 **정밀한 동작 관리**에 적합함
  - 다양한 센서 및 입력 장치와 연동이 용이하여 **자동화 시스템 구현**에 필수적임
  - **HMI와의 연동이 가능**하여 사용자 명령을 즉시 반영할 수 있음  

- **HMI (Human-Machine Interface)**
  - 전철의 **운행 상태를 직관적으로 모니터링**할 수 있음
  - 터치스크린을 통해 **운영자가 직접 명령을 입력**할 수 있어 제어 편의성이 향상됨
  - 긴급 상황 발생 시 **즉각적인 대응이 가능하도록 설계**할 수 있음



## 🙋‍♂️ 내가 구현한 기능

### 🚆 PLC  
- 키를 꼽으면 시동이 걸려 동작하도록 구현  
- 운행 준비 단계인 **Power On/Off, EB (Emergency Train Stop Button) 구현**  
- 출입문 상태(열림/닫힘) 확인 및 **출입문 닫힘 타이밍 알림 설정**  
- 가속 중 EB 버튼을 눌렀을 때 **전철이 멈추고 속도가 0으로 초기화되지 않던 버그 수정**  
- 속도가 100 이상일 때 브레이크를 눌러도 **속도가 떨어지지 않던 버그 수정**  
- **역 도착 시 다음 역을 표시**하고, 해당 역을 가리키는 지점 설정  
- 브레이크를 눌러도 **속도가 0으로 초기화되지 않던 버그 수정**  
- 키를 뽑았을 때 **전철이 멈추도록 구현**  
- **상황에 따라 축전기 전압 변화를 반영하도록 구현**  

### 🎛️ HMI  
- 기존 비트 램프로 개별적으로 동작하던 **출입문 램프를 N상 램프로 교체**하여 상황별 역할 부여  
- 비트 램프로 개별적으로 동작하던 **EB 버튼 램프를 N상 램프 1개로 통합**하여 역할을 통합  
- HMI에서 **스크립트(C언어)**를 이용해 **"전진 버튼"과 "정지 버튼"이 동시에 작동하지 않도록 코드 구현**


## 🌲 프로젝트 구조

###
```plaintext
📌 PLC 코드
📂 NewProgram        # PLC 프로젝트 메인 코드
├── main.lxp        # 기본 PLC 로직
└── button.lxp      # 버튼 기능 구현을 위한 사용자 펑션블록

🎛️ HMI 화면 및 스크립트
📂 공덕역            # 운행 관련 기능 추가 및 실험 모델
📂 테스트            # 최종 버전 시뮬레이션
📂 스크립트          # 스크립트
├── 전철운행_0000.스크립트  # 남은 거리가 200M 이하일 때 "정차역 램프" 깜박임
└── 버튼.스크립트  # 중복 입력 방지 버튼 스크립트
